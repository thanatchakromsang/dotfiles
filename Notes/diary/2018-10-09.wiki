=09 Oct 2018 - *AND OR Rules improve*=

== Template ==
%% | * [ ] <text> -- project:<name> +<tag>
%% | project: personal, pronto, squadbeat, college
%% | -> - -> a) -> 1)...

== DAILY LOG ==

| time  | event                                |
|-------|--------------------------------------|
| 10:00 | stand up meetings                    |
| 10:59 | understanding material and resources |

== WHAT I WILL DO TODAY | due:2018-10-09+22hour !-COMPLETED ==

== WHAT I DID TODAY | end:2018-10-09 ==

== WHAT ELSE I DID TODAY ==

== WHAT I WILL DO TOMORROW | due:2018-10-09+46hour ==
* [ ] use middlewares instead of helmet (2018-10-10 22:00)  #e1a1c9a3
* [ ] schema test (2018-10-10 22:00)  #03edc53c

== WHAT I DID YESTERDAY | end:2018-10-09-24hour ==

=---------------------------------=

== TODAY NOTES ==
{{{python
from surveys.utils import process_audience_rules

delivery_setting = EmailDeliverySetting.objects.get(survey_url='http://gateway:8000/api/survey/survey/FO7UUMZB6eRGMZ1uBgi0MbD7fJYzm6rhRb7QgDkhnbI/')
customers = process_audience_rules(delivery_setting)

}}}

- Important
  - 1 SurveySendingRule is per 1 condition // Which mean all survey sending rule for 1 company combined together in SurveySendingRules models

current request payload to gateway API
{{{json
{
	"audience_rule_operator": "and",
	"audience_rules": [
    {
      "_id": 1,
      "condition": "is",
      "field": "is_active",
      "value": "true"
    },
    {
      "_id": 2,
      "condition": "is_not",
      "field": "custom_attributes__at_survey_opt_out_status",
      "value": "hello_world"
    },
    {
      "_id": 3,
      "condition": "is_not",
      "field": "email",
      "value": "cory@prontomarketing.com"
    }
  ],
	"survey_id": 31
}
}}}

purposed request payload to gateway API
{{{json

{
	"audience_rules": [
    {
      "_id": 1,
      "audience_rule_operator": "and",
      "condition": "is",
      "field": "is_active",
      "value": "true"
    },
    {
      "_id": 2,
      "audience_rule_operator": "or",
      "condition": "is_not",
      "field": "custom_attributes__at_survey_opt_out_status",
      "value": "hello_world"
    },
    {
      "_id": 3,
      "audience_rule_operator": "or",
      "condition": "is_not",
      "field": "email",
      "value": "cory@prontomarketing.com"
    }
  ],
	"survey_id": 31
}

}}}

Format to send to SurveySendingRuleAPI
API : http://localhost:8003/api/surveys/survey-sending-rules/
{{{json
{
	"survey_url": "http://gateway:8000/api/survey/survey/FO7UUMZB6eRGMZ1uBgi0MbD7fJYzm6rhRb7QgDkhnbI/",
	"owned_by": "http://gateway:8000/api/account/company/1086/",
	"audience_rules": [
		{
			"_id": 1,
			"audience_rule_operator": "and",
			"condition": "is",
			"field": "is_active",
			"value": "true"
		},
		{
			"_id": 2,
			"audience_rule_operator": "or",
			"condition": "is_not",
			"field": "custom_attributes__at_survey_opt_out_status",
			"value": "hello_world"
		},
		{
			"_id": 3,
			"audience_rule_operator": "or",
			"condition": "is_not",
			"field": "email",
			"value": "cory@prontomarketing.com"
		}
	]
}
}}}
